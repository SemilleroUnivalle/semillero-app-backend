services:
  backend:
    build: 
      context: ./HTTP
    command: sh -c "python manage.py migrate && gunicorn -c gunicorn_config.py semillero_backend.wsgi:application"
    volumes:
      - ./HTTP:/app
    container_name: semillero_backend
    ports:
      - "8080:8080"
    environment:
      - DEBUG=0
      - DATABASE_URL=postgres://postgres:postgres@db:5432/postgres
      - SECRET_KEY=dev_secret_key_change_in_production
    networks:
      - semillero-net

  websocket:
    build: 
      context: ./websocket
    container_name: semillero_websocket
    command: uvicorn main:app --reload --host 0.0.0.0 --port 8000
    volumes:
      - ./websocket:/app
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgres://postgres:admin@database:5432/postgres
    networks:
      - semillero-net

networks:
  semillero-net:
    external: true

volumes:
  postgres_data: